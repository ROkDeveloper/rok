///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2024, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область ОбработчикиСобытийФормы

&НаСервере
// Обработчик события создания формы на сервере
// Параметры:
//   Отказ - признак отказа от создания формы
//   СтандартнаяОбработка - признак стандартной обработки
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	УстановитьУсловноеОформление();
	ПереключитьВидимостьСчетовВНедействующихБанках(Ложь);

КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
// Обработчик команды переключения видимости счетов в недействующих банках
// Параметры:
//   Команда - команда формы
Процедура ПоказыватьСчетаВНедействующихБанках(Команда)
	
	// Проверяем существование элемента формы
	Если Элементы.Найти("ФормаПоказыватьСчетаВНедействующихБанках") = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ПереключитьВидимостьСчетовВНедействующихБанках(Не Элементы.ФормаПоказыватьСчетаВНедействующихБанках.Пометка);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
// Переключает видимость счетов в недействующих банках
// Параметры:
//   Видимость - признак видимости счетов в недействующих банках
Процедура ПереключитьВидимостьСчетовВНедействующихБанках(Видимость)

	// Проверяем существование элемента формы
	Если Элементы.Найти("ФормаПоказыватьСчетаВНедействующихБанках") = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Элементы.ФормаПоказыватьСчетаВНедействующихБанках.Пометка = Видимость;

	// Константы для имен полей
	ИмяПоляДеятельностьБанка = "ДеятельностьБанкаПрекращена";
	
	ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбораДинамическогоСписка(
			Список, ИмяПоляДеятельностьБанка, Ложь,,, Не Видимость);

КонецПроцедуры

&НаСервере
// Устанавливает условное оформление для списка
// Выделяет серым цветом записи с прекращенной деятельностью банка
Процедура УстановитьУсловноеОформление()

	// Проверяем существование списка
	Если Список = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Список.УсловноеОформление.Элементы.Очистить();
	Элемент = Список.УсловноеОформление.Элементы.Добавить();

	// Константы для имен полей
	ИмяПоляДеятельностьБанка = "ДеятельностьБанкаПрекращена";
	
	ОтборЭлемента = Элемент.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение = Новый ПолеКомпоновкиДанных(ИмяПоляДеятельностьБанка);
	ОтборЭлемента.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = Истина;

	Элемент.Оформление.УстановитьЗначениеПараметра("ЦветТекста", ЦветаСтиля.ТекстЗапрещеннойЯчейкиЦвет);

КонецПроцедуры

#КонецОбласти